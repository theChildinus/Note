# GO Web 编程

## 第一章 GO 与 Web 应用

### 使用GO语言构建Web应用

大规模可拓展的Web应用通常需要具备一下特质：

1. 可拓展
2. 模块化
3. 可维护
4. 高性能

### Web应用的工作原理

从纯粹且狭隘的角度看，Web应用应该是这样的计算机程序：它对客户端发送的HTTP请求作出响应，并通过HTTP响应将HTML回传至客户端

应用是一个与用户进行互动并帮助用户执行指定活动的软件程序

一个程序满足以下两个条件，我们就可以把它看作是一个Web应用：

- 这个程序必须向发送命令请求的客户端返回HTML，而客户端则会向用户展示渲染后的HTML
- 这个程序在向客户端传送数据时必须使用HTTP协议

在此基础上，如果一个程序不是向用户渲染并展示HTML，而是向其他程序返回某些非HTML格式的数据，那么这个程序就是一个为其他程序提供服务的Web服务

### HTTP简介

HTTP 是一种无状态、由文本构成的请求-响应协议，这种协议使用的是客户端-服务器计算模型

Web 应用是为了通过HTTP向用户发送定制的动态内容而诞生的

### HTTP请求

- 请求行(request-line)
- 零个或任意多个请求首部(header)
- 一个空行
- 可选的报文主体(body)

#### 请求方法

- HTTP 0.9 GET
- HTTP 1.0 + POST HEAD
- HTTP 1.1 + PUT DELETE OPTIONS TRACE CONNECT

具体说来：

- GET - 命令服务器返回指定的资源
- HEAD - 与GET方法的作用类似，这个方法用于不获取报文主体的情况下，取得响应的头部
- POST - 命令服务器将报文主体中的数据传输给URI指定的资源，至于服务器具体会对这些资源做什么动作则取决于服务器本身
- PUT - 命令服务器将报文主体中的数据设置为URI指定的资源，存在则替换，不存在则新建
- DELETE - 命令服务器删除URI指定的资源
- TRACE - 命令服务器返回请求本身，通过这个办法，客户端可以知道介于它和服务器之间的其他服务器是如何处理请求的
- OPTIONS - 命令服务器返回它支持的HTTP方法列表
- CONNECT - 命令服务器与客户端建立一个网络链接，通常用于设置SSL隧道以开启HTTPS功能
- PATCH - 命令服务器使用报文主体中的数据对URI指定的资源进行修改

GET、HEAD、OPTIONS和TRACE 它们都是安全的方法，POST、PUT、DELETE都是不安全的方法

安全的方法天生就是幂等的，PUT和DELETE虽然不安全但是是幂等的，POST既不安全也不幂等

#### 请求首部

HTTP请求方法定义了发送请求的客户端想要执行的动作，而HTTP请求的首部则记录了与请求本身以及客户端有关的信息

宿主（Host）首部字段是 HTTP 1.1 唯一强制要求的首部，根据请求使用的方法不同，如果请求的报文中包含有可选的主体，那么请求的首部还需要带有内容长度（Content-Length）字段或传输编码（Transfer-Encoding）字段

| 首部字段       | 作用描述                                                     |
| -------------- | :----------------------------------------------------------- |
| Accept         | 客户端在 HTTP 响应中能够接受的内容类型                       |
| Accept-Charset | 客户端要求服务器使用的字符集编码                             |
| Authorization  | 这个首部用于向服务器发送基本的身份验证证书                   |
| Cookie         | 客户端应该在这个首部中把服务器之前设置的所有cookie回传给服务器，比如说，如果服务器之前在浏览器上设置了时那个cookie，那么Cookie首部字段将在一个字符串里包含这三个cookie，并使用分号对这些cookie进行分隔 |
| Content-Length | 请求主体的字段长度                                           |
| Content-Type   | 当请求包含主体的时候，这个首部用于记录主体内容的类型，在发送POST和PUT请求时，内容的类型默认为`x-www-form-urlen-coded`，但是在上传文件时，内容类型应该设置为`multipart/form-data` |
| Host           | 服务器的名字以及端口号                                       |
| Referrer       | 发起请求的页面所在的地址                                     |
| User-Agent     | 对发起请求的客户端进行描述                                   |

### HTTP响应

- 一个状态行
- 零个或任意数量的响应首部
- 一个空行
- 一个可选的报文主体

#### 响应状态码

| 状态码类型 | 作用描述                                                     |
| ---------- | ------------------------------------------------------------ |
| 1XX        | 情报状态码，服务器通过这些来告诉客户端，自己已经接收到了客户端发送的请求，并且已经对请求进行了处理 |
| 2XX        | 成功状态码                                                   |
| 3XX        | 重定向状态码，服务器已经接收到了客户端发送的请求，并且已经成功处理了请求，但为了完成指定的动作，客户端还需要再做一些其他工作，大多用于实现URL重定向 |
| 4XX        | 客户端错误状态码，客户端发送的请求出现了某些问题，`404 Not Found`表示服务器无法从请求指定的URL中知道客户端想要的资源 |
| 5XX        | 服务器错误状态码，当服务器因为某些原因而无法正确的处理请求时，服务器就会通过这类状态码通知客户端 |

#### 响应首部

| 首部字段         | 作用描述                                                     |
| ---------------- | ------------------------------------------------------------ |
| Allow            | 告知客户端，服务器支持那些请求方法                           |
| Content-Length   | 响应主体的字节长度                                           |
| Content-Type     | 如果响应包含可选的主体，那么这个首部记录的就是主体内容的类型 |
| Date             | 当前时间                                                     |
| Location         | 这个首部在重定向时使用，它会告知客户端接下来向哪个URL发送请求 |
| Server           | 返回响应的服务器的域名                                       |
| Set-Cookie       | 在客户端里面设置一个cookie，一个响应里面可以包含多个Set-Cookie首部 |
| WWW-Authenticate | 服务器通过这个首部来告知客户端，在Authorization请求首部中应该提供那些类型的身份信息，服务器通常会把这个首部与`401 Unauthorized`状态行一同发送 |

### URI

### HTTP/2 简介

与使用纯文本方式表示的HTTP1.x不同，HTTP/2是一种二进制协议：二进制表示不仅能够让HTTP/2的语法分析变得更为高效，还能让协议变得更加紧凑和健壮

HTTP/2是完全多路复用的，这意味着多个请求和响应可以在同一时间内使用同一个连接，除此之外，HTTP/2还会对首部进行压缩以减少需要传送的数据量，并允许服务器将响应推送至客户端

### Web应用的各个组成部分

Web应用就是一个执行以下任务的程序：

1. 通过HTTP协议，以HTTP请求报文的形式获取客户端输入
2. 对HTTP请求报文进行处理，并执行必要的操作
3. 生成HTML，并以HTTP响应报文的形式将其返回给客户端

为了完成这个任务，Web应用被分成了处理器和模板引擎这两个部分

#### 处理器

Web应用中的处理器除了要接收和处理和客户端发来的请求，还要调用模板引擎，然后由模板引擎生成HTML并把数据填充至将要回传给客户端的响应报文当中

用MVC模式来讲，处理器既是控制器（controller），也是模型（model），控制器应该是苗条的，它应该只包含路由代码以及HTTP报文的解包和打包逻辑，而模型则应该是丰满的，它应该包含应用的逻辑以及数据

#### 模板引擎

通过HTTP响应报文回传给客户端的HTML是由模板转换而成的，模板里面可能会包含HTML，但也可能不会，而模板引擎则通过模板和数据来生成最终的HTML

- 静态模板 是一些夹杂着占位符的HTML，静态模板引擎通过将静态模板中的占位符替换成响应的数据来生成最终的HTML
- 动态模板 除了包含HTML和占位符之外，还包含一些编程语言结构，如条件语句、迭代语句和变量 JSP/ASP/ERB 都属于动态模板引擎

